// //server/attendance-service/prisma/schema.prisma
generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}
datasource db {
  provider = "postgresql"
  schemas  = ["attendance"]
}
enum AttendanceStatus {
  PRESENT
  ABSENT
  @@schema("attendance")
}
enum SessionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  @@schema("attendance")
}
model AttendanceSession {
  id              String           @id @default(cuid())
  teacherId       String           // from user-service.TeacherProfile.id
  courseId        String           // from user-service.Course.id
  sessionDate     DateTime         @default(now())
  sessionStartTime DateTime
  sessionEndTime  DateTime
  qrCode          String           @unique
  qrGeneratedAt   DateTime         @default(now())
  qrExpiresAt     DateTime
  status          SessionStatus    @default(ACTIVE)
  location        String?
  remarks         String?
  attendanceRecords AttendanceRecord[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  @@index([teacherId])
  @@index([courseId])
  @@index([sessionDate])
  @@index([qrCode])
  @@schema("attendance")
}
model AttendanceRecord {
  id              String           @id @default(cuid())
  sessionId       String
  session         AttendanceSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  studentId       String           // from user-service.StudentProfile.id
  enrollmentNumber String?
  status          AttendanceStatus @default(ABSENT)
  markedAt        DateTime?
  hasApprovedOutpass Boolean      @default(false)
  outpassCheckAt   DateTime?
  latitude        Float?
  longitude       Float?
  remarks         String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  @@unique([sessionId, studentId])
  @@index([studentId])
  @@index([status])
  @@schema("attendance")
}




